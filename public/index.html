<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Reception Slideshow</title>
<style>
html, body {
  margin: 0;
  width: 100%;
  height: 100%;
  background: black;
  overflow: hidden;
}
img {
  position: absolute;
  max-width: 100%;
  max-height: 100%;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  opacity: 0;
  transition: opacity 1s;
}
</style>
</head>
<body>
<img id="slide">

<script>
const SLIDE_INTERVAL = 11000; // 11 seconds
const RESCAN_INTERVAL = 15 * 60 * 1000; // 15 minutes
let images = [];
let index = 0;
const slide = document.getElementById('slide');

// Fetch images from server
async function fetchImages() {
  try {
    const res = await fetch('/images');
    let data = await res.json();

    // Filter out empty URLs
    data = data.filter(url => url);

    // Randomize
    images = data.sort(() => Math.random() - 0.5);

    // Reset index
    index = 0;
  } catch (err) {
    console.error('Error fetching images:', err);
  }
}

// Show next image
function showNext() {
  if (!images.length) return;

  slide.style.opacity = 0;
  setTimeout(() => {
    slide.src = images[index];
    slide.onload = () => slide.style.opacity = 1;
    index = (index + 1) % images.length;
  }, 500);
}

// Start slideshow
async function start() {
  await fetchImages();
  showNext();
  setInterval(showNext, SLIDE_INTERVAL);
  setInterval(fetchImages, RESCAN_INTERVAL);
}

// Fullscreen on load
document.documentElement.requestFullscreen?.();

start();
</script>
</body>
</html>
