<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Reception Slideshow</title>
<style>
html, body { margin:0; width:100%; height:100%; background:black; overflow:hidden; }
img { position:absolute; max-width:100%; max-height:100%; top:50%; left:50%; transform:translate(-50%,-50%); opacity:0; transition:opacity 1s; }
</style>
</head>
<body>
<img id="slide">

<script>
const SLIDE_INTERVAL = 11000; // 11s
const RESCAN_INTERVAL = 15*60*1000; // 15 min

let images = [];
let index = 0;
const slide = document.getElementById('slide');

async function fetchImages() {
  const res = await fetch('/images');
  images = await res.json();
  images = images.filter(url => url); // remove empty
  images = images.sort(() => Math.random() - 0.5); // shuffle
  index = 0;
}

function showNext() {
  if (!images.length) return;
  slide.style.opacity = 0;
  setTimeout(() => {
    slide.src = images[index];
    slide.onload = () => slide.style.opacity = 1;
    index = (index + 1) % images.length;
  }, 500);
}

async function start() {
  await fetchImages();
  showNext();
  setInterval(showNext, SLIDE_INTERVAL);
  setInterval(fetchImages, RESCAN_INTERVAL);
}

start();
</script>
</body>
</html>
